<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>/Users/loren/.bundler/ruby/1.8/aws-s3-96a4abc3f450/lib/aws/s3/acl.rb</title>
    <link href="screen.css" media="all" rel="stylesheet" type="text/css" />
    <link href="print.css" media="print" rel="stylesheet" type="text/css" />
    
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <script type="text/javascript" src="rcov.js"></script>
  </head>
  <body>
    <h1>Usasearch C0 Coverage Information - RCov</h1>
    <h2>/Users/loren/.bundler/ruby/1.8/aws-s3-96a4abc3f450/lib/aws/s3/acl.rb</h2>

    

    <div class="report_table_wrapper">
      <table class='report' id='report_table'>
        <thead>
          <tr>
            <th class="left_align">Name</th>
            <th class="right_align">Total Lines</th>
            <th class="right_align">Lines of Code</th>
            <th class="left_align">Total Coverage</th>
            <th class="left_align">Code Coverage</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="left_align"><a href="-Users-loren-_bundler-ruby-1_8-aws-s3-96a4abc3f450-lib-aws-s3-acl_rb.html">/Users/loren/.bundler/ruby/1.8/aws-s3-96a4abc3f450/lib/aws/s3/acl.rb</a></td>
            <td class='right_align'><tt>636</tt></td>
            <td class='right_align'><tt>317</tt></td>
            <td class="left_align"><div class="percent_graph_legend"><tt class=''>62.89%</tt></div>
          <div class="percent_graph">
            <div class="covered" style="width:63px"></div>
            <div class="uncovered" style="width:37px"></div>
          </div></td>
            <td class="left_align"><div class="percent_graph_legend"><tt class=''>29.34%</tt></div>
          <div class="percent_graph">
            <div class="covered" style="width:29px"></div>
            <div class="uncovered" style="width:71px"></div>
          </div></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <h3>Key</h3>
    
    <div class="key"><pre><span class='marked'>Code reported as executed by Ruby looks like this...</span><span class='marked1'>and this: this line is also marked as covered.</span><span class='inferred'>Lines considered as run by rcov, but not reported by Ruby, look like this,</span><span class='inferred1'>and this: these lines were inferred by rcov (using simple heuristics).</span><span class='uncovered'>Finally, here's a line marked as not executed.</span></pre></div>

    <h3>Coverage Details</h3>

    <table class="details">
      <tbody>
        
          
          
          <tr class="marked">
            <td><pre><a name="line1">1</a> module AWS</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line2">2</a>   module S3</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line3">3</a>     # By default buckets are private. This means that only the owner has access rights to the bucket and its objects. </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line4">4</a>     # Objects in that bucket inherit the permission of the bucket unless otherwise specified. When an object is private, the owner can </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line5">5</a>     # generate a signed url that exposes the object to anyone who has that url. Alternatively, buckets and objects can be given other </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line6">6</a>     # access levels. Several canned access levels are defined:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line7">7</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line8">8</a>     # * &lt;tt&gt;:private&lt;/tt&gt; - Owner gets FULL_CONTROL. No one else has any access rights. This is the default.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line9">9</a>     # * &lt;tt&gt;:public_read&lt;/tt&gt; - Owner gets FULL_CONTROL and the anonymous principal is granted READ access. If this policy is used on an object, it can be read from a browser with no authentication.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line10">10</a>     # * &lt;tt&gt;:public_read_write&lt;/tt&gt; - Owner gets FULL_CONTROL, the anonymous principal is granted READ and WRITE access. This is a useful policy to apply to a bucket, if you intend for any anonymous user to PUT objects into the bucket.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line11">11</a>     # * &lt;tt&gt;:authenticated_read&lt;/tt&gt; - Owner gets FULL_CONTROL, and any principal authenticated as a registered Amazon S3 user is granted READ access.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line12">12</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line13">13</a>     # You can set a canned access level when you create a bucket or an object by using the &lt;tt&gt;:access&lt;/tt&gt; option:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line14">14</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line15">15</a>     #   S3Object.store(</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line16">16</a>     #     'kiss.jpg', </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line17">17</a>     #     data, </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line18">18</a>     #     'marcel', </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line19">19</a>     #     :access =&gt; :public_read</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line20">20</a>     #   )</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line21">21</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line22">22</a>     # Since the image we created is publicly readable, we can access it directly from a browser by going to the corresponding bucket name </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line23">23</a>     # and specifying the object's key without a special authenticated url:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line24">24</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line25">25</a>     #  http://s3.amazonaws.com/marcel/kiss.jpg</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line26">26</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line27">27</a>     # ==== Building custum access policies</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line28">28</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line29">29</a>     # For both buckets and objects, you can use the &lt;tt&gt;acl&lt;/tt&gt; method to see its access control policy:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line30">30</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line31">31</a>     #   policy = S3Object.acl('kiss.jpg', 'marcel')</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line32">32</a>     #   pp policy.grants</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line33">33</a>     #   [#&lt;AWS::S3::ACL::Grant FULL_CONTROL to noradio&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line34">34</a>     #    #&lt;AWS::S3::ACL::Grant READ to AllUsers Group&gt;]</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line35">35</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line36">36</a>     # Policies are made up of one or more grants which grant a specific permission to some grantee. Here we see the default FULL_CONTROL grant </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line37">37</a>     # to the owner of this object. There is also READ permission granted to the Allusers Group, which means anyone has read access for the object.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line38">38</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line39">39</a>     # Say we wanted to grant access to anyone to read the access policy of this object. The current READ permission only grants them permission to read </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line40">40</a>     # the object itself (for example, from a browser) but it does not allow them to read the access policy. For that we will need to grant the AllUsers group the READ_ACP permission.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line41">41</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line42">42</a>     # First we'll create a new grant object:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line43">43</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line44">44</a>     #   grant = ACL::Grant.new</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line45">45</a>     #   # =&gt; #&lt;AWS::S3::ACL::Grant (permission) to (grantee)&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line46">46</a>     #   grant.permission = 'READ_ACP'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line47">47</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line48">48</a>     # Now we need to indicate who this grant is for. In other words, who the grantee is:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line49">49</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line50">50</a>     #   grantee = ACL::Grantee.new</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line51">51</a>     #   # =&gt; #&lt;AWS::S3::ACL::Grantee (xsi not set yet)&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line52">52</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line53">53</a>     # There are three ways to specify a grantee: 1) by their internal amazon id, such as the one returned with an object's Owner, </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line54">54</a>     # 2) by their Amazon account email address or 3) by specifying a group. As of this writing you can not create custom groups, but </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line55">55</a>     # Amazon does provide three already: AllUsers, Authenticated and LogDelivery. In this case we want to provide the grant to all users. </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line56">56</a>     # This effectively means &quot;anyone&quot;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line57">57</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line58">58</a>     #   grantee.group = 'AllUsers'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line59">59</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line60">60</a>     # Now that our grantee is setup, we'll associate it with the grant:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line61">61</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line62">62</a>     #   grant.grantee = grantee</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line63">63</a>     #   grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line64">64</a>     #   # =&gt; #&lt;AWS::S3::ACL::Grant READ_ACP to AllUsers Group&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line65">65</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line66">66</a>     # Are grant has all the information we need. Now that it's ready, we'll add it on to the object's access control policy's list of grants:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line67">67</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line68">68</a>     #   policy.grants &lt;&lt; grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line69">69</a>     #   pp policy.grants</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line70">70</a>     #   [#&lt;AWS::S3::ACL::Grant FULL_CONTROL to noradio&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line71">71</a>     #    #&lt;AWS::S3::ACL::Grant READ to AllUsers Group&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line72">72</a>     #    #&lt;AWS::S3::ACL::Grant READ_ACP to AllUsers Group&gt;]</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line73">73</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line74">74</a>     # Now that the policy has the new grant, we reuse the &lt;tt&gt;acl&lt;/tt&gt; method to persist the policy change:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line75">75</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line76">76</a>     #   S3Object.acl('kiss.jpg', 'marcel', policy)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line77">77</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line78">78</a>     # If we fetch the object's policy again, we see that the grant has been added:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line79">79</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line80">80</a>     #   pp S3Object.acl('kiss.jpg', 'marcel').grants</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line81">81</a>     #   [#&lt;AWS::S3::ACL::Grant FULL_CONTROL to noradio&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line82">82</a>     #    #&lt;AWS::S3::ACL::Grant READ to AllUsers Group&gt;,</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line83">83</a>     #    #&lt;AWS::S3::ACL::Grant READ_ACP to AllUsers Group&gt;]</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line84">84</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line85">85</a>     # If we were to access this object's acl url from a browser: </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line86">86</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line87">87</a>     #   http://s3.amazonaws.com/marcel/kiss.jpg?acl</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line88">88</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line89">89</a>     # we would be shown its access control policy.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line90">90</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line91">91</a>     # ==== Pre-prepared grants</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line92">92</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line93">93</a>     # Alternatively, the ACL::Grant class defines a set of stock grant policies that you can fetch by name. In most cases, you can </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line94">94</a>     # just use one of these pre-prepared grants rather than building grants by hand. Two of these stock policies are &lt;tt&gt;:public_read&lt;/tt&gt; </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line95">95</a>     # and &lt;tt&gt;:public_read_acp&lt;/tt&gt;, which happen to be the two grants that we built by hand above. In this case we could have simply written:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line96">96</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line97">97</a>     #   policy.grants &lt;&lt; ACL::Grant.grant(:public_read)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line98">98</a>     #   policy.grants &lt;&lt; ACL::Grant.grant(:public_read_acp)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line99">99</a>     #   S3Object.acl('kiss.jpg', 'marcel', policy)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line100">100</a>     # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line101">101</a>     # The full details can be found in ACL::Policy, ACL::Grant and ACL::Grantee.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line102">102</a>     module ACL</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line103">103</a>       # The ACL::Policy class lets you inspect and modify access controls for buckets and objects.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line104">104</a>       # A policy is made up of one or more Grants which specify a permission and a Grantee to whom that permission is granted.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line105">105</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line106">106</a>       # Buckets and objects are given a default access policy which contains one grant permitting the owner of the bucket or object</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line107">107</a>       # FULL_CONTROL over its contents. This means they can read the object, write to the object, as well as read and write its</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line108">108</a>       # policy.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line109">109</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line110">110</a>       # The &lt;tt&gt;acl&lt;/tt&gt; method for both buckets and objects returns the policy object for that entity:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line111">111</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line112">112</a>       #   policy = Bucket.acl('some-bucket')</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line113">113</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line114">114</a>       # The &lt;tt&gt;grants&lt;/tt&gt; method of a policy exposes its grants. You can treat this collection as an array and push new grants onto it:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line115">115</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line116">116</a>       #   policy.grants &lt;&lt; grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line117">117</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line118">118</a>       # Check the documentation for Grant and Grantee for more details on how to create new grants.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line119">119</a>       class Policy</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line120">120</a>         include SelectiveAttributeProxy #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line121">121</a>         attr_accessor :owner, :grants</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line122">122</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line123">123</a>         def initialize(attributes = {})</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line124">124</a>           @attributes = attributes</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line125">125</a>           @grants     = [].extend(GrantListExtensions)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line126">126</a>           extract_owner!  if owner?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line127">127</a>           extract_grants! if grants?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line128">128</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line129">129</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line130">130</a>         # The xml representation of the policy.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line131">131</a>         def to_xml</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line132">132</a>           Builder.new(owner, grants).to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line133">133</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line134">134</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line135">135</a>         private</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line136">136</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line137">137</a>           def owner?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line138">138</a>             attributes.has_key?('owner') || !owner.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line139">139</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line140">140</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line141">141</a>           def grants?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line142">142</a>             (attributes.has_key?('access_control_list') &amp;&amp; attributes['access_control_list']['grant']) || !grants.empty?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line143">143</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line144">144</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line145">145</a>           def extract_owner!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line146">146</a>             @owner = Owner.new(attributes.delete('owner'))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line147">147</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line148">148</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line149">149</a>           def extract_grants!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line150">150</a>             attributes['access_control_list']['grant'].each do |grant|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line151">151</a>               grants &lt;&lt; Grant.new(grant)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line152">152</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line153">153</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line154">154</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line155">155</a>           module GrantListExtensions #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line156">156</a>             def include?(grant)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line157">157</a>               case grant</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line158">158</a>               when Symbol</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line159">159</a>                 super(ACL::Grant.grant(grant))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line160">160</a>               else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line161">161</a>                 super</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line162">162</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line163">163</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line164">164</a>             </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line165">165</a>             def delete(grant)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line166">166</a>               case grant</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line167">167</a>               when Symbol</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line168">168</a>                 super(ACL::Grant.grant(grant))</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line169">169</a>               else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line170">170</a>                 super</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line171">171</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line172">172</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line173">173</a>             </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line174">174</a>             # Two grant lists are equal if they have identical grants both in terms of permission and grantee.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line175">175</a>             def ==(grants)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line176">176</a>               size == grants.size &amp;&amp; all? {|grant| grants.include?(grant)}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line177">177</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line178">178</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line179">179</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line180">180</a>         class Builder &lt; XmlGenerator #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line181">181</a>           attr_reader :owner, :grants</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line182">182</a>           def initialize(owner, grants)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line183">183</a>             @owner  = owner</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line184">184</a>             @grants = grants.uniq # There could be some duplicate grants</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line185">185</a>             super()</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line186">186</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line187">187</a>       </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line188">188</a>           def build</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line189">189</a>             xml.tag!('AccessControlPolicy', 'xmlns' =&gt; 'http://s3.amazonaws.com/doc/2006-03-01/') do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line190">190</a>               xml.Owner do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line191">191</a>                 xml.ID owner.id</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line192">192</a>                 xml.DisplayName owner.display_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line193">193</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line194">194</a>               </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line195">195</a>               xml.AccessControlList do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line196">196</a>                 xml &lt;&lt; grants.map {|grant| grant.to_xml}.join(&quot;\n&quot;)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line197">197</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line198">198</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line199">199</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line200">200</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line201">201</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line202">202</a>       </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line203">203</a>       # A Policy is made up of one or more Grant objects. A grant sets a specific permission and grants it to the associated grantee.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line204">204</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line205">205</a>       # When creating a new grant to add to a policy, you need only set its permission and then associate with a Grantee.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line206">206</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line207">207</a>       #   grant = ACL::Grant.new</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line208">208</a>       #   =&gt; #&lt;AWS::S3::ACL::Grant (permission) to (grantee)&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line209">209</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line210">210</a>       # Here we see that neither the permission nor the grantee have been set. Let's make this grant provide the READ permission.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line211">211</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line212">212</a>       #   grant.permission = 'READ'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line213">213</a>       #   grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line214">214</a>       #   =&gt; #&lt;AWS::S3::ACL::Grant READ to (grantee)&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line215">215</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line216">216</a>       # Now let's assume we have a grantee to the AllUsers group already set up. Just associate that grantee with our grant. </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line217">217</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line218">218</a>       #   grant.grantee = all_users_group_grantee</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line219">219</a>       #   grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line220">220</a>       #   =&gt; #&lt;AWS::S3::ACL::Grant READ to AllUsers Group&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line221">221</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line222">222</a>       # And now are grant is complete. It provides READ permission to the AllUsers group, effectively making this object publicly readable</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line223">223</a>       # without any authorization.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line224">224</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line225">225</a>       # Assuming we have some object's policy available in a local variable called &lt;tt&gt;policy&lt;/tt&gt;, we can now add this grant onto its</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line226">226</a>       # collection of grants.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line227">227</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line228">228</a>       #   policy.grants &lt;&lt; grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line229">229</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line230">230</a>       # And then we send the updated policy to the S3 servers.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line231">231</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line232">232</a>       #   some_s3object.acl(policy)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line233">233</a>       class Grant</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line234">234</a>         include SelectiveAttributeProxy #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line235">235</a>         constant :VALID_PERMISSIONS, %w(READ WRITE READ_ACP WRITE_ACP FULL_CONTROL)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line236">236</a>         attr_accessor :grantee</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line237">237</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line238">238</a>         class &lt;&lt; self</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line239">239</a>           # Returns stock grants with name &lt;tt&gt;type&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line240">240</a>           #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line241">241</a>           #   public_read_grant = ACL::Grant.grant :public_read</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line242">242</a>           #   =&gt; #&lt;AWS::S3::ACL::Grant READ to AllUsers Group&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line243">243</a>           #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line244">244</a>           # Valid stock grant types are:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line245">245</a>           #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line246">246</a>           # * &lt;tt&gt;:authenticated_read&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line247">247</a>           # * &lt;tt&gt;:authenticated_read_acp&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line248">248</a>           # * &lt;tt&gt;:authenticated_write&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line249">249</a>           # * &lt;tt&gt;:authenticated_write_acp&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line250">250</a>           # * &lt;tt&gt;:logging_read&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line251">251</a>           # * &lt;tt&gt;:logging_read_acp&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line252">252</a>           # * &lt;tt&gt;:logging_write&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line253">253</a>           # * &lt;tt&gt;:logging_write_acp&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line254">254</a>           # * &lt;tt&gt;:public_read&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line255">255</a>           # * &lt;tt&gt;:public_read_acp&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line256">256</a>           # * &lt;tt&gt;:public_write&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line257">257</a>           # * &lt;tt&gt;:public_write_acp&lt;/tt&gt;</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line258">258</a>           def grant(type)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line259">259</a>             case type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line260">260</a>             when *stock_grant_map.keys</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line261">261</a>               build_stock_grant_for type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line262">262</a>             else</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line263">263</a>               raise ArgumentError, &quot;Unknown grant type `#{type}'&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line264">264</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line265">265</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line266">266</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line267">267</a>           private</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line268">268</a>             def stock_grant_map</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line269">269</a>               grant        = lambda {|permission, group| {:permission =&gt; permission, :group =&gt; group}}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line270">270</a>               groups       = {:public =&gt; 'AllUsers', :authenticated =&gt; 'Authenticated', :logging =&gt; 'LogDelivery'}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line271">271</a>               permissions  = %w(READ WRITE READ_ACP WRITE_ACP)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line272">272</a>               stock_grants = {}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line273">273</a>               groups.each do |grant_group_name, group_name|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line274">274</a>                 permissions.each do |permission|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line275">275</a>                   stock_grants[&quot;#{grant_group_name}_#{permission.downcase}&quot;.to_sym] = grant[permission, group_name]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line276">276</a>                 end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line277">277</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line278">278</a>               stock_grants</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line279">279</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line280">280</a>             memoized :stock_grant_map</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line281">281</a>             </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line282">282</a>             def build_stock_grant_for(type)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line283">283</a>               stock_grant = stock_grant_map[type]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line284">284</a>               grant = new do |g|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line285">285</a>                 g.permission = stock_grant[:permission]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line286">286</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line287">287</a>               grant.grantee = Grantee.new do |gr|</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line288">288</a>                 gr.group = stock_grant[:group]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line289">289</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line290">290</a>               grant</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line291">291</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line292">292</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line293">293</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line294">294</a>         def initialize(attributes = {})</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line295">295</a>           attributes = {'permission' =&gt; nil}.merge(attributes)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line296">296</a>           @attributes = attributes</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line297">297</a>           extract_grantee!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line298">298</a>           yield self if block_given?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line299">299</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line300">300</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line301">301</a>         # Set the permission for this grant.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line302">302</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line303">303</a>         #   grant.permission = 'READ'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line304">304</a>         #   grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line305">305</a>         #   =&gt; #&lt;AWS::S3::ACL::Grant READ to (grantee)&gt;</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line306">306</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line307">307</a>         # If the specified permisison level is not valid, an &lt;tt&gt;InvalidAccessControlLevel&lt;/tt&gt; exception will be raised.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line308">308</a>         def permission=(permission_level)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line309">309</a>           unless self.class.valid_permissions.include?(permission_level)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line310">310</a>             raise InvalidAccessControlLevel.new(self.class.valid_permissions, permission_level)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line311">311</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line312">312</a>           attributes['permission'] = permission_level</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line313">313</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line314">314</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line315">315</a>         # The xml representation of this grant.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line316">316</a>         def to_xml</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line317">317</a>           Builder.new(permission, grantee).to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line318">318</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line319">319</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line320">320</a>         def inspect #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line321">321</a>           &quot;#&lt;%s:0x%s %s&gt;&quot; % [self.class, object_id, self]</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line322">322</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line323">323</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line324">324</a>         def to_s #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line325">325</a>           [permission || '(permission)', 'to', grantee ? grantee.type_representation : '(grantee)'].join ' '</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line326">326</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line327">327</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line328">328</a>         def eql?(grant) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line329">329</a>           # This won't work for an unposted AmazonCustomerByEmail because of the normalization</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line330">330</a>           # to CanonicalUser but it will work for groups.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line331">331</a>           to_s == grant.to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line332">332</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line333">333</a>         alias_method :==, :eql?</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line334">334</a>                 </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line335">335</a>         def hash #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line336">336</a>           to_s.hash</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line337">337</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line338">338</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line339">339</a>         private</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line340">340</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line341">341</a>           def extract_grantee!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line342">342</a>             @grantee = Grantee.new(attributes['grantee']) if attributes['grantee']</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line343">343</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line344">344</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line345">345</a>         class Builder &lt; XmlGenerator #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line346">346</a>           attr_reader :grantee, :permission</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line347">347</a>       </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line348">348</a>           def initialize(permission, grantee)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line349">349</a>             @permission = permission</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line350">350</a>             @grantee    = grantee</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line351">351</a>             super()</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line352">352</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line353">353</a>       </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line354">354</a>           def build</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line355">355</a>             xml.Grant do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line356">356</a>               xml &lt;&lt; grantee.to_xml</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line357">357</a>               xml.Permission permission</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line358">358</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line359">359</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line360">360</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line361">361</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line362">362</a>       </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line363">363</a>       # Grants bestow a access permission to grantees. Each grant of some access control list Policy is associated with a grantee.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line364">364</a>       # There are three ways of specifying a grantee at the time of this writing.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line365">365</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line366">366</a>       # * By canonical user - This format uses the &lt;tt&gt;id&lt;/tt&gt; of a given Amazon account. The id value for a given account is available in the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line367">367</a>       #  Owner object of a bucket, object or policy.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line368">368</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line369">369</a>       #   grantee.id = 'bb2041a25975c3d4ce9775fe9e93e5b77a6a9fad97dc7e00686191f3790b13f1'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line370">370</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line371">371</a>       # Often the id will just be fetched from some owner object.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line372">372</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line373">373</a>       #   grantee.id = some_object.owner.id</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line374">374</a>       # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line375">375</a>       # * By amazon email address - You can specify an email address for any Amazon account. The Amazon account need not be signed up with the S3 service.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line376">376</a>       # though it must be unique across the entire Amazon system. This email address is normalized into a canonical user representation once the grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line377">377</a>       # has been sent back up to the S3 servers.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line378">378</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line379">379</a>       #   grantee.email_address = 'joe@example.org'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line380">380</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line381">381</a>       # * By group - As of this writing you can not create custom groups, but Amazon provides three group that you can use. See the documentation for the</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line382">382</a>       # Grantee.group= method for details.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line383">383</a>       #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line384">384</a>       #   grantee.group = 'Authenticated'</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line385">385</a>       class Grantee</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line386">386</a>         include SelectiveAttributeProxy #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line387">387</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line388">388</a>         undef_method :id if method_defined?(:id) # Get rid of Object#id</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line389">389</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line390">390</a>         def initialize(attributes = {})</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line391">391</a>           # Set default values for attributes that may not be passed in but we still want the object</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line392">392</a>           # to respond to</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line393">393</a>           attributes = {'id' =&gt; nil, 'display_name' =&gt; nil, 'email_address' =&gt; nil, 'uri' =&gt; nil}.merge(attributes)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line394">394</a>           @attributes = attributes</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line395">395</a>           extract_type!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line396">396</a>           yield self if block_given?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line397">397</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line398">398</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line399">399</a>         # The xml representation of the current grantee object.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line400">400</a>         def to_xml</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line401">401</a>           Builder.new(self).to_s</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line402">402</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line403">403</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line404">404</a>         # Returns the type of grantee. Will be one of &lt;tt&gt;CanonicalUser&lt;/tt&gt;, &lt;tt&gt;AmazonCustomerByEmail&lt;/tt&gt; or &lt;tt&gt;Group&lt;/tt&gt;.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line405">405</a>         def type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line406">406</a>           return attributes['type'] if attributes['type']</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line407">407</a>           </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line408">408</a>           # Lookups are in order of preference so if, for example, you set the uri but display_name and id are also</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line409">409</a>           # set, we'd rather go with the canonical representation.</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line410">410</a>           if display_name &amp;&amp; id</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line411">411</a>             'CanonicalUser'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line412">412</a>           elsif email_address</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line413">413</a>             'AmazonCustomerByEmail'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line414">414</a>           elsif uri</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line415">415</a>             'Group'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line416">416</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line417">417</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line418">418</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line419">419</a>         # Sets the grantee's group by name.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line420">420</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line421">421</a>         #   grantee.group = 'AllUsers'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line422">422</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line423">423</a>         # Currently, valid groups defined by S3 are:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line424">424</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line425">425</a>         # * &lt;tt&gt;AllUsers&lt;/tt&gt;: This group represents anyone. In other words, an anonymous request.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line426">426</a>         # * &lt;tt&gt;Authenticated&lt;/tt&gt;: Any authenticated account on the S3 service.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line427">427</a>         # * &lt;tt&gt;LogDelivery&lt;/tt&gt;: The entity that delivers bucket access logs.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line428">428</a>         def group=(group_name)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line429">429</a>           section  = %w(AllUsers Authenticated).include?(group_name) ? 'global' : 's3'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line430">430</a>           self.uri = &quot;http://acs.amazonaws.com/groups/#{section}/#{group_name}&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line431">431</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line432">432</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line433">433</a>         # Returns the grantee's group. If the grantee is not a group, &lt;tt&gt;nil&lt;/tt&gt; is returned.</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line434">434</a>         def group</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line435">435</a>           return unless uri</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line436">436</a>           uri[%r([^/]+$)]</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line437">437</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line438">438</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line439">439</a>         def type_representation #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line440">440</a>           case type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line441">441</a>           when 'CanonicalUser'          then display_name || id</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line442">442</a>           when 'AmazonCustomerByEmail'  then email_address</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line443">443</a>           when 'Group'                  then &quot;#{group} Group&quot;</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line444">444</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line445">445</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line446">446</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line447">447</a>         def inspect #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line448">448</a>           &quot;#&lt;%s:0x%s %s&gt;&quot; %  [self.class, object_id, type_representation || '(type not set yet)']</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line449">449</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line450">450</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line451">451</a>         private</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line452">452</a>           def extract_type!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line453">453</a>             attributes['type'] = attributes.delete('xsi:type')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line454">454</a>           end            </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line455">455</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line456">456</a>         class Builder &lt; XmlGenerator #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line457">457</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line458">458</a>           def initialize(grantee)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line459">459</a>             @grantee = grantee</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line460">460</a>             super()</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line461">461</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line462">462</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line463">463</a>           def build</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line464">464</a>             xml.tag!('Grantee', attributes) do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line465">465</a>               representation</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line466">466</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line467">467</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line468">468</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line469">469</a>           private</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line470">470</a>             attr_reader :grantee</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line471">471</a>             </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line472">472</a>             def representation</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line473">473</a>               case grantee.type</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line474">474</a>               when 'CanonicalUser'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line475">475</a>                 xml.ID grantee.id</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line476">476</a>                 xml.DisplayName grantee.display_name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line477">477</a>               when 'AmazonCustomerByEmail'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line478">478</a>                 xml.EmailAddress grantee.email_address</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line479">479</a>               when 'Group'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line480">480</a>                 xml.URI grantee.uri</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line481">481</a>               end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line482">482</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line483">483</a>             </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line484">484</a>             def attributes</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line485">485</a>               {'xsi:type' =&gt; grantee.type, 'xmlns:xsi' =&gt; 'http://www.w3.org/2001/XMLSchema-instance'}</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line486">486</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line487">487</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line488">488</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line489">489</a>       </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line490">490</a>       module Bucket</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line491">491</a>         def self.included(klass) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line492">492</a>           klass.extend(ClassMethods)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line493">493</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line494">494</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line495">495</a>         module ClassMethods</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line496">496</a>           # The acl method is the single point of entry for reading and writing access control list policies for a given bucket.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line497">497</a>           #   </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line498">498</a>           #   # Fetch the acl for the 'marcel' bucket</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line499">499</a>           #   policy = Bucket.acl 'marcel'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line500">500</a>           #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line501">501</a>           #   # Modify the policy ...</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line502">502</a>           #   # ...</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line503">503</a>           # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line504">504</a>           #   # Send updated policy back to the S3 servers</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line505">505</a>           #   Bucket.acl 'marcel', policy </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line506">506</a>           def acl(name = nil, policy = nil)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line507">507</a>             if name.is_a?(ACL::Policy)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line508">508</a>               policy = name</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line509">509</a>               name   = nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line510">510</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line511">511</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line512">512</a>             path = path(name) &lt;&lt; '?acl'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line513">513</a>             respond_with ACL::Policy::Response do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line514">514</a>               policy ? put(path, {}, policy.to_xml) : ACL::Policy.new(get(path(name) &lt;&lt; '?acl').policy)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line515">515</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line516">516</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line517">517</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line518">518</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line519">519</a>         # The acl method returns and updates the acl for a given bucket.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line520">520</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line521">521</a>         #   # Fetch a bucket</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line522">522</a>         #   bucket = Bucket.find 'marcel'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line523">523</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line524">524</a>         #   # Add a grant to the bucket's policy</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line525">525</a>         #   bucket.acl.grants &lt;&lt; some_grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line526">526</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line527">527</a>         #   # Write the changes to the policy</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line528">528</a>         #   bucket.acl(bucket.acl)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line529">529</a>         def acl(reload = false)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line530">530</a>           policy = reload.is_a?(ACL::Policy) ? reload : nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line531">531</a>           expirable_memoize(reload) do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line532">532</a>             self.class.acl(name, policy) if policy</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line533">533</a>             self.class.acl(name)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line534">534</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line535">535</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line536">536</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line537">537</a>       </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line538">538</a>       module S3Object</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line539">539</a>         def self.included(klass) #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line540">540</a>           klass.extend(ClassMethods)</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line541">541</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line542">542</a>         </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line543">543</a>         module ClassMethods</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line544">544</a>           # The acl method is the single point of entry for reading and writing access control list policies for a given object.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line545">545</a>           #   </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line546">546</a>           #   # Fetch the acl for the 'kiss.jpg' object in the 'marcel' bucket</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line547">547</a>           #   policy = S3Object.acl 'kiss.jpg', 'marcel'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line548">548</a>           #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line549">549</a>           #   # Modify the policy ...</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line550">550</a>           #   # ...</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line551">551</a>           # </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line552">552</a>           #   # Send updated policy back to the S3 servers</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line553">553</a>           #   S3Object.acl 'kiss.jpg', 'marcel', policy</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line554">554</a>           def acl(name, bucket = nil, policy = nil)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line555">555</a>             # We're using the second argument as the ACL::Policy</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line556">556</a>             if bucket.is_a?(ACL::Policy)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line557">557</a>               policy = bucket</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line558">558</a>               bucket = nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line559">559</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line560">560</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line561">561</a>             bucket = bucket_name(bucket)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line562">562</a>             path   = path!(bucket, name) &lt;&lt; '?acl'</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line563">563</a> </pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line564">564</a>             respond_with ACL::Policy::Response do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line565">565</a>               policy ? put(path, {}, policy.to_xml) : ACL::Policy.new(get(path).policy)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line566">566</a>             end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line567">567</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line568">568</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line569">569</a>         </pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line570">570</a>         # The acl method returns and updates the acl for a given s3 object.</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line571">571</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line572">572</a>         #   # Fetch a the object</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line573">573</a>         #   object = S3Object.find 'kiss.jpg', 'marcel'</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line574">574</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line575">575</a>         #   # Add a grant to the object's</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line576">576</a>         #   object.acl.grants &lt;&lt; some_grant</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line577">577</a>         #</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line578">578</a>         #   # Write the changes to the policy</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line579">579</a>         #   object.acl(object.acl)</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line580">580</a>         def acl(reload = false)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line581">581</a>           policy = reload.is_a?(ACL::Policy) ? reload : nil</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line582">582</a>           expirable_memoize(reload) do</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line583">583</a>             self.class.acl(key, bucket.name, policy) if policy</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line584">584</a>             self.class.acl(key, bucket.name)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line585">585</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line586">586</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line587">587</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line588">588</a>           </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line589">589</a>       class OptionProcessor #:nodoc:</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line590">590</a>         attr_reader :options</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line591">591</a>         class &lt;&lt; self</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line592">592</a>           def process!(options)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line593">593</a>             new(options).process!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line594">594</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line595">595</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line596">596</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line597">597</a>         def initialize(options)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line598">598</a>           options.to_normalized_options!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line599">599</a>           @options      = options</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line600">600</a>           @access_level = extract_access_level</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line601">601</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line602">602</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line603">603</a>         def process!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line604">604</a>           return unless access_level_specified?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line605">605</a>           validate!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line606">606</a>           options['x-amz-acl'] = access_level</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line607">607</a>         end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line608">608</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line609">609</a>         private</pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line610">610</a>           def extract_access_level</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line611">611</a>              options.delete('access') || options.delete('x-amz-acl')</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line612">612</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line613">613</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line614">614</a>           def validate!</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line615">615</a>             raise InvalidAccessControlLevel.new(valid_levels, access_level) unless valid?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line616">616</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line617">617</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line618">618</a>           def valid?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line619">619</a>             valid_levels.include?(access_level)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line620">620</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line621">621</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line622">622</a>           def access_level_specified?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line623">623</a>             !@access_level.nil?</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line624">624</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line625">625</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line626">626</a>           def valid_levels</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line627">627</a>             %w(private public-read public-read-write authenticated-read)</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line628">628</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="inferred">
            <td><pre><a name="line629">629</a> </pre></td>
          </tr>
        
          
          
          <tr class="marked">
            <td><pre><a name="line630">630</a>           def access_level</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line631">631</a>             @normalized_access_level ||= @access_level.to_header</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line632">632</a>           end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line633">633</a>       end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line634">634</a>     end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line635">635</a>   end</pre></td>
          </tr>
        
          
          
          <tr class="uncovered">
            <td><pre><a name="line636">636</a> end</pre></td>
          </tr>
        
      </tbody>
    </table>

    <p>Generated on Mon May 23 20:35:53 -0700 2011 with <a href="http://github.com/relevance/rcov">rcov 0.9.8</a></p>

  </body>
</html>
