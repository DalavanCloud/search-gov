= spelling_suggestion(search, @affiliate) if (search)
- if search.results.present?
  %hr.topresults
  - if (search && search.recalls && search.recalls.total > 0)
    .group{:id => "recalls"}
      %h1 Recent Recalls
      - search.recalls.hits.each_with_index do |hit, index|
        .row{:id => "recall#{index+1}"}
          .links= (link_to "#{highlight_like_solr(hit.instance.summary, hit.highlights)}, #{hit.instance.recalled_on.to_formatted_s(:short).strip}".html_safe, hit.instance.recall_url)
  .group
    - affiliate_name = @affiliate.present? ? @affiliate.name : nil
    - search.results.each_with_index do |search_result, index|
      .row{:id => "searchresult#{index+1}"}
        .searchResult
          .title= display_result_title(search_result, search, affiliate_name, index)
          .content
            = display_result_description(search_result)
          .links= shorten_url(search_result['unescapedUrl'])
          - if index.zero? and search.page.zero?
            = display_deep_links_for(search_result)
      - unless index == search.results.length - 1 then
        %hr
  .group
    .row.center
      = will_paginate search.results, :page_links => false, :previous_label => "", :next_label => t(:next_page)

  - if (search && search.related_search.present?)
    #relatedsearch
      %p= t :searches_related_to, :query=> search.query
      %ul
        - search.related_search.each_with_index do |related_term, index|
          %li= tracked_click_link(search_path(:query=>related_term, :affiliate=> @affiliate ),h(related_term.titleize), search, nil, index, 'CREL')

- elsif search.error_message
  %p.noresults #{search.error_message}
- else
  = no_results_for search.query
