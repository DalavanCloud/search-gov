= content_for_site_page_title @site, 'Queries'
= form_for @queries_request, url: { action: :create }, html: { class: 'form form-search' }  do |form|
  .sub-nav-heading
    %h2 Queries
    .action-bar
      %ul
        = list_item_with_link_to_current_help_page
        %li= form.submit 'Generate Report', class: 'btn submit btn-primary'
  = render form

- if @queries_request.top_queries.present?
  %p Tip: Select the hyperlinked number in the # of Clicks column to view the top clicked URLs for each query.
  %table.table.table-striped.table-bordered.table-kv-pairs
    %thead
      %tr
        %th Top Queries
        %th # of Queries
        %th # of Clicks
        %th CTR
    %tbody
      - @queries_request.top_queries.each_with_index do |query_click_count, idx|
        %tr
          %td
            = "#{idx+1}."
            = query_click_count.query
            = query_drilldown_link(@site, query_click_count.query, @queries_request.start_date, @queries_request.end_date )
          %td= number_with_delimiter(query_click_count.queries)
          %td= link_to_unless query_click_count.clicks.zero?, number_with_delimiter(query_click_count.clicks), site_query_clicks_path(@site,
            {:query => query_click_count.query, :start_date => @queries_request.start_date, :end_date => @queries_request.end_date})
          %td= number_to_percentage(query_click_count.ctr, precision: 1)
- elsif @queries_request.query.present?
  %p= "Sorry, no results found for '#{@queries_request.query}'."
- else
  %p Your site has not received any search queries yet.
