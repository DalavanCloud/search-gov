= analytics_center_breadcrumbs 'Monthly Reports'
#h1
  Monthly Usage

- form_tag(monthly_reports_path, :method => :get) do
  = select_date @report_date, { :discard_day => true, :start_year => 2010, :end_year => @most_recent_date.year }
  = submit_tag 'Get Usage Stats'
%br
- if @report_date.future?
  %p
    Report information not available for the future.
- else
  .span-14
    %h3= "Monthly Usage Stats for #{Date::MONTHNAMES[@report_date.month.to_i]} #{@report_date.year}"
    - DailyUsageStat::PROFILE_NAMES.each do |profile_name|
      .usage_stats{ :id => "#{profile_name.downcase}_usage_stats" }
        Profile: #{profile_name}
        %ul
          %li
            Total Queries: #{number_with_delimiter @monthly_totals[profile_name][:total_queries]}
          %li
            Total Page Views: #{number_with_delimiter @monthly_totals[profile_name][:total_page_views]}
          %li
            Total Unique Visitors: #{number_with_delimiter @monthly_totals[profile_name][:total_unique_visitors]}
    %p
      = analytics_monthly_report_link(@report_date)
  - if @clicks.present?
    .span-6
      %h3 Clicks by module
      %table{:id => "module_click_stats"}
        %tr
          %th Module
          %th{:style=>"text-align: right"} Clicks
        - @clicks.each do |monthly_click_total|
          %tr
            %td= monthly_click_total.source
            %td{:style=>"text-align: right"}= number_with_delimiter(monthly_click_total.total)

  .span-24.headertitle
    .span-21
      %h2 Most Popular Queries
    .span-3.last
      %form
        = display_select_for_monthly_reports_window("mpq", @num_results_mpq, @report_date)
  .span-24{:id=>"pop_queries"}
    = render :partial => "analytics/shared/query_counts_table", :locals => { :query_counts => @popular_queries_for_month , :content_name => "pop_queries", :heading => "Monthly Total", :affiliate => nil}
  .span-24.headertitle
    .span-21
      %h2 Most Popular Query Groups
    .span-3.last
      %form
        = display_select_for_monthly_reports_window("mpqg", @num_results_mpqg, @report_date)
  .span-24.last{:id=>"pop_query_groups"}
    = render :partial => "analytics/shared/query_counts_table", :locals => { :query_counts => @popular_groups_for_month , :content_name => "pop_query_groups", :heading => "Monthly Total", :affiliate => nil}
